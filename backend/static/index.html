<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Detector | AI Powered</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#6366f1",
                        secondary: "#ec4899",
                        dark: "#0f172a",
                        surface: "#1e293b",
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- React & Babel (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Axios & Lucide (CDN) -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background-color: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            background: linear-gradient(to right, #6366f1, #ec4899);
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.2);
        }
        .btn-primary:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // --- Icons (Lucide is globally available but needs mapping or SVG usage in React simple setup)
        // For simplicity in CDN React, we'll use simple SVGs or mapping if Lucide global is tricky.
        // Lucide provides `lucide.createIcons()` but within React components it's easier to just use SVGs directly 
        // OR a small wrapper. Let's use simple SVGs for reliability in this no-build setup.

        const IconShield = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>;
        const IconDashboard = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>;
        const IconHistory = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>;
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconAlert = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>;

        // --- Components

        const Dashboard = () => {
            const [url, setUrl] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');

            const handleScan = async (e) => {
                e.preventDefault();
                if (!url) return;
                setLoading(true);
                setError('');
                setResult(null);

                try {
                    const response = await axios.post('/scan', { url });
                    setResult(response.data);
                } catch (err) {
                    setError('Failed to scan URL. Is the backend running?');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="flex flex-col items-center justify-center pt-10 px-4 animate-fade-in-up">
                    <div className="text-center mb-10 space-y-4 max-w-2xl">
                        <h1 className="text-4xl md:text-6xl font-extrabold text-white tracking-tight">
                            Verify Links in <span className="bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">Real-Time</span>
                        </h1>
                        <p className="text-gray-400 text-lg">
                            Advanced AI detection for Phishing & Malware. Powered by Deep Learning and Gemini.
                        </p>
                    </div>

                    <div className="w-full max-w-3xl">
                        <form onSubmit={handleScan} className="relative group">
                            <div className="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-xl blur opacity-25 group-hover:opacity-40 transition duration-1000"></div>
                            <div className="relative glass-card p-2 flex items-center">
                                <span className="ml-3 text-gray-400"><IconSearch /></span>
                                <input 
                                    type="text" 
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                    placeholder="Paste a suspicious URL here..."
                                    className="bg-transparent border-none outline-none text-white w-full px-4 py-3 placeholder-gray-500 text-lg focus:ring-0"
                                />
                                <button type="submit" disabled={loading} className="btn-primary shrink-0 disabled:opacity-50">
                                    {loading ? 'Scanning...' : 'Scan Now'}
                                </button>
                            </div>
                        </form>

                        {error && <div className="mt-6 p-4 bg-red-500/10 border border-red-500/20 text-red-200 rounded-lg">{error}</div>}

                        {result && (
                            <div className="mt-8 glass-card p-6 md:p-8 relative overflow-hidden">
                                <div className={`absolute top-0 left-0 w-1 h-full ${result.status === 'Safe' ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                <div className="flex justify-between items-center mb-6">
                                    <div className="flex items-center space-x-3">
                                        {result.status === 'Safe' ? <IconCheck /> : <IconAlert />}
                                        <h2 className={`text-2xl font-bold ${result.status === 'Safe' ? 'text-green-400' : 'text-red-400'}`}>
                                            {result.status}
                                        </h2>
                                    </div>
                                    <div className="bg-white/5 px-4 py-2 rounded-lg text-center">
                                        <span className="block text-xs text-gray-400 uppercase">Confidence</span>
                                        <span className="text-2xl font-bold text-white">{(result.confidence * 100).toFixed(1)}%</span>
                                    </div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-5 border border-white/5">
                                    <h3 className="text-sm font-semibold text-gray-300 uppercase mb-2">AI Analysis</h3>
                                    <p className="text-gray-300 whitespace-pre-line text-sm">{result.analysis}</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const History = () => {
            const [history, setHistory] = useState([]);
            const [stats, setStats] = useState({ safe_count: 0, malicious_count: 0, total_scans: 0 });

            useEffect(() => {
                Promise.all([
                    axios.get('/history'),
                    axios.get('/stats')
                ]).then(([h, s]) => {
                    setHistory(h.data);
                    setStats(s.data);
                });
            }, []);

            return (
                 <div className="max-w-6xl mx-auto pt-6 animate-fade-in-up">
                    <h1 className="text-3xl font-bold text-white mb-8 border-l-4 border-primary pl-4">Scan History</h1>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                       <div className="glass-card p-6 text-center">
                            <div className="text-gray-400 text-sm uppercase">Total Scans</div>
                            <div className="text-4xl font-bold text-secondary mt-2">{stats.total_scans}</div>
                       </div>
                       <div className="glass-card p-6 text-center">
                            <div className="text-gray-400 text-sm uppercase">Malicious</div>
                            <div className="text-4xl font-bold text-red-500 mt-2">{stats.malicious_count}</div>
                       </div>
                       <div className="glass-card p-6 text-center">
                            <div className="text-gray-400 text-sm uppercase">Safe</div>
                            <div className="text-4xl font-bold text-green-500 mt-2">{stats.safe_count}</div>
                       </div>
                    </div>

                    <div className="glass-card overflow-hidden">
                        <table className="w-full text-left text-sm text-gray-300">
                            <thead className="bg-white/5 uppercase text-xs font-semibold text-gray-400">
                                <tr>
                                    <th className="px-6 py-4">Status</th>
                                    <th className="px-6 py-4">URL</th>
                                    <th className="px-6 py-4">Confidence</th>
                                    <th className="px-6 py-4">Date</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-white/5">
                                {history.map((item, idx) => (
                                    <tr key={idx} className="hover:bg-white/5">
                                        <td className="px-6 py-4">
                                             <span className={`px-2 py-1 rounded text-xs font-bold ${item.status === 'Safe' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                                {item.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 max-w-xs truncate">{item.url}</td>
                                        <td className="px-6 py-4">{(item.confidence * 100).toFixed(1)}%</td>
                                        <td className="px-6 py-4">{new Date(item.timestamp).toLocaleDateString()}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('dashboard');

            return (
                <div className="min-h-screen">
                    <nav className="glass-card m-4 px-6 py-4 flex justify-between items-center sticky top-4 z-50">
                        <div className="flex items-center space-x-2 text-white font-bold text-xl">
                            <IconShield />
                            <span className="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">URL SafeGuard</span>
                        </div>
                        <div className="flex space-x-1">
                            <button 
                                onClick={() => setView('dashboard')} 
                                className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${view==='dashboard' ? 'bg-primary/20 text-white' : 'text-gray-400 hover:text-white'}`}
                            >
                                <IconDashboard /> <span>Dashboard</span>
                            </button>
                            <button 
                                onClick={() => setView('history')} 
                                className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${view==='history' ? 'bg-primary/20 text-white' : 'text-gray-400 hover:text-white'}`}
                            >
                                <IconHistory /> <span>History</span>
                            </button>
                        </div>
                    </nav>

                    <main className="container mx-auto p-4">
                        {view === 'dashboard' ? <Dashboard /> : <History />}
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
